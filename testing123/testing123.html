<!DOCTYPE html>
    <html lang="en">
      <head>
        <title>bom dia</title>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.0.0/p5.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.12/Tone.js"></script>
        <link rel="stylesheet" type="text/css" href="style/pop.css">
      </head>
      <body>
        <div id="container">
          <button id="startContext" onclick="startAudioContext()">start</button>
          <button id="newSound" onclick="popSound()">pop!</button>
        </div>
      </body>

      <script>

        var audioCtx = Tone.context;
        var arp = new Tone.Player('assets/arp.mp3');
        var heavysleeper = new Tone.Player('assets/heavysleeper.mp3');
        var amp = new Tone.Volume(-21.0).toDestination();
        const buffers = [arp, heavysleeper];
        var timer;

        const getRandomColors = () => {
            var letters = '0123456789ABCDEF';
            var color = '#';
            for (var i = 0; i < 6; i++) {
                color += letters[Math.floor(Math.random() * 16)];
            }
            return color;
        }

        function startAudioContext() {
          audioCtx.resume();
        }

        function popSound(){

          var ctn = document.getElementById('container');
          var pop = document.createElement("div");
          ctn.appendChild(pop);
          pop.classList.add("pixel-1", "pixel-init");
          pop.style.left = Math.random()*window.innerWidth+"px";
          pop.style.top = Math.random()*window.innerHeight+"px";
          pop.style.backgroundColor = getRandomColors();
          pop.setAttribute("data-bufnum", Math.floor(Math.random()*buffers.length));
          pop.setAttribute("onmouseleave", "hideSound(this)");
          pop.setAttribute("onmouseenter", "peekSound(this)");
        }

        function peekSound(element) {
          clearTimeout(timer);
          buffers[element.dataset.bufnum].connect(amp);
          buffers[element.dataset.bufnum].start();
          amp.volume.value = Math.min(0.0, amp.volume.value + 3.0);
          var scale = Math.max(Math.pow(10, amp.volume.value / 20), 0.1);
          element.style.width = 80*scale+"px";
          element.style.height = 80*scale+"px";
          console.log(scale);

        }

        function hideSound(element) {
          timer = setTimeout(function() {
            amp.volume.value = -21.0;
            element.style.width = "2px";
            element.style.height = "2px";
          }, 1000);
        }

      </script>

    </html>
